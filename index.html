<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Матрица Эйзенхауэра</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f0f1f6;
  --panel:#ffffff;
  --border:#e1e2e8;
  --text:#1f1f1f;
  --muted:#7a7a8c;
  --accent:#5c6bc0;
  --note-bg:#fafafa;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif;}
body{display:flex;flex-direction:column;height:100vh;background:var(--bg);color:var(--text);}
header{padding:20px;text-align:center;font-weight:600;font-size:24px;letter-spacing:0.5px;color:var(--accent);}
.board{flex:1;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;gap:16px;padding:16px;}
.quadrant{position:relative;background:var(--panel);border-radius:20px;padding:16px;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,0.08);transition:0.3s;}
.q1{--q:#ff8a80;}
.q2{--q:#80d8ff;}
.q3{--q:#ffd180;}
.q4{--q:#a7ffeb;}
.quadrant::before{content:'';position:absolute;left:0;top:0;bottom:0;width:6px;background:var(--q);border-radius:20px 0 0 20px;}
.quadrant.drag-over{outline:2px dashed var(--accent);background:rgba(92,107,192,0.05);}
h2{font-weight:600;font-size:16px;margin-bottom:12px;color:var(--q);}
.note{background:var(--note-bg);padding:12px 14px;border-radius:14px;margin-bottom:12px;cursor:grab;box-shadow:0 6px 18px rgba(0,0,0,0.08);transition:0.2s;}
.note:hover{transform:translateY(-2px);}
.note-time{font-size:12px;color:var(--muted);margin-top:4px;}
.tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px;}
.tag{background:var(--accent);color:#fff;font-size:11px;padding:2px 6px;border-radius:6px;}
.modal{position:fixed;inset:0;background:rgba(31,31,31,0.4);display:none;align-items:center;justify-content:center;z-index:10;}
.modal-content{background:var(--panel);padding:20px;width:360px;border-radius:20px;box-shadow:0 8px 24px rgba(0,0,0,0.15);}
label{font-size:13px;color:var(--muted);margin-top:12px;display:block;}
textarea,input,select{width:100%;margin-top:6px;padding:10px;border-radius:12px;border:1px solid var(--border);font-family:inherit;}
.actions{display:flex;gap:10px;margin-top:16px;}
button{padding:10px;border:none;border-radius:12px;font-weight:600;cursor:pointer;transition:0.2s;}
.save{background:var(--accent);color:#fff;}
.save:hover{background:#3f51b5;}
.delete{background:#ff6b6b;color:#fff;}
.delete:hover{background:#e53935;}
.pomodoro{border-top:1px solid var(--border);padding:16px;display:grid;grid-template-columns:1fr 1fr;gap:10px;background:var(--panel);}
.pomo-controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
.timer{grid-column:1/3;text-align:center;font-size:22px;font-weight:600;color:var(--accent);}
.pomo-btn{background:var(--accent);color:#fff;}
.gray{background:#b0b0b0;color:#fff;}
@media(max-width:768px){.board{grid-template-columns:1fr;}}
</style>
</head>
<body>

<header>Матрица Эйзенхауэра</header>

<div class="board">
<div class="quadrant q1"><h2>Важно · Срочно</h2></div>
<div class="quadrant q2"><h2>Важно · Не срочно</h2></div>
<div class="quadrant q3"><h2>Не важно · Срочно</h2></div>
<div class="quadrant q4"><h2>Не важно · Не срочно</h2></div>
</div>

<div class="modal" id="modal">
<div class="modal-content">
<label>Название задачи</label>
<textarea id="taskText"></textarea>
<label>Срок выполнения</label>
<input type="datetime-local" id="taskDeadline">
<label>Теги</label>
<input id="taskTags">
<label>Комментарий</label>
<textarea id="taskComment"></textarea>
<div class="actions">
<button class="save" onclick="saveTask()">Сохранить</button>
<button class="delete" onclick="deleteTask()">Удалить</button>
</div>
</div>
</div>

<div class="pomodoro">
<div>
<label>Работа (мин)</label>
<input type="number" id="workTime" value="25">
</div>
<div>
<label>Отдых (мин)</label>
<input type="number" id="restTime" value="5">
</div>
<div class="pomo-controls">
<button class="pomo-btn" onclick="startTimer()">Старт</button>
<button class="gray" onclick="pauseTimer()">Пауза</button>
<button class="gray" onclick="stopTimer()">Стоп</button>
<button class="gray" onclick="setMode('work')">Работа</button>
<button class="gray" onclick="setMode('rest')">Отдых</button>
</div>
<div class="timer" id="timer">25:00</div>
</div>

<script>
let activeQuadrant=null, editingNote=null, draggedNote=null;
let timerInterval=null, remaining=0, mode='work';
const beep=new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=");

document.querySelectorAll('.quadrant').forEach(q=>{
q.onclick=e=>{if(e.target.closest('.note')) return;activeQuadrant=q;openModal(null);};
q.ondragover=e=>{e.preventDefault();q.classList.add('drag-over');};
q.ondragleave=()=>q.classList.remove('drag-over');
q.ondrop=()=>{q.classList.remove('drag-over');if(draggedNote){q.appendChild(draggedNote);updateNoteColor(draggedNote,q);}};
});

function updateNoteColor(note,q){
note.style.backgroundColor=`color-mix(in srgb, ${getComputedStyle(q).getPropertyValue('--q')} 25%, var(--note-bg))`;
}

function openModal(note){editingNote=note;modal.style.display='flex';taskText.value=note?.dataset.text||'';taskDeadline.value=note?.dataset.deadline||'';taskTags.value=note?.dataset.tags||'';taskComment.value=note?.dataset.comment||'';}
function saveTask(){
let note=editingNote||document.createElement('div');
note.className='note';note.draggable=true;
note.dataset.text=taskText.value;note.dataset.deadline=taskDeadline.value;note.dataset.tags=taskTags.value;note.dataset.comment=taskComment.value;
note.innerHTML=`<div>${taskText.value}</div>${taskDeadline.value?`<div class="note-time">${new Date(taskDeadline.value).toLocaleString()}</div>`:''}<div class="tags">${renderTags(taskTags.value)}</div>`;
note.onclick=e=>{e.stopPropagation();openModal(note);};
note.ondragstart=()=>draggedNote=note;note.ondragend=()=>draggedNote=null;
if(!editingNote) activeQuadrant.appendChild(note);
updateNoteColor(note,activeQuadrant);
closeModal();
}
function deleteTask(){if(editingNote) editingNote.remove();closeModal();}
function renderTags(str){return str.split(/[,#]/).filter(t=>t.trim()).map(t=>`<span class="tag">#${t.trim()}</span>`).join('');}
function closeModal(){modal.style.display='none';editingNote=null;}

/* POMODORO */
function startTimer(){clearInterval(timerInterval);remaining=(mode==='work'?workTime.value:restTime.value)*60;tick();timerInterval=setInterval(runTimer,1000);}
function pauseTimer(){clearInterval(timerInterval);}
function stopTimer(){clearInterval(timerInterval);remaining=0;tick();}
function setMode(m){mode=m;remaining=(mode==='work'?workTime.value:restTime.value)*60;tick();}
function runTimer(){remaining--;tick();if(remaining<=0){beep.play();notify("Pomodoro завершен");setMode(mode==='work'?'rest':'work');}}
function tick(){let m=String(Math.floor(remaining/60)).padStart(2,'0');let s=String(remaining%60).padStart(2,'0');timer.textContent=`${m}:${s}`;}

/* Notifications */
if(Notification.permission!=="granted")Notification.requestPermission();
function notify(msg){if(Notification.permission==="granted"){new Notification("Матрица Эйзенхауэра",{body:msg});}}

/* Deadline check every minute */
setInterval(()=>{document.querySelectorAll('.note').forEach(n=>{if(!n.dataset.deadline) return;let d=new Date(n.dataset.deadline).getTime();let now=Date.now();if(d-now>0 && d-now<=30*60*1000 && !n.dataset.notified){notify(`Задача "${n.dataset.text}" через 30 минут!`);n.dataset.notified=true;}});},60000);
</script>
</body>
</html>
