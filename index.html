<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Матрица Эйзенхауэра</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0d1020;
  --panel:#1b1f2e;
  --text:#f5f6fa;
  --muted:#9aa0b5;
  --accent:#6f7dff;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,sans-serif;}

body{
  min-height:100vh;
  background:
    linear-gradient(rgba(255,255,255,.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,.04) 1px, transparent 1px),
    var(--bg);
  background-size:40px 40px;
  color:var(--text);
}

header{
  text-align:center;
  padding:18px;
  font-size:26px;
  font-weight:700;
  color:var(--accent);
}

.board{padding:14px;display:grid;gap:12px;}
.quadrant{
  position:relative;
  background:linear-gradient(180deg,#1e2334,#191d2b);
  border-radius:22px;
  padding:16px 18px 18px 22px;
  box-shadow:0 10px 24px rgba(0,0,0,.45);
}
.quadrant::before{
  content:'';
  position:absolute;left:0;top:0;bottom:0;width:5px;
  border-radius:22px 0 0 22px;
}
.q1::before{background:#ff6b6b;}
.q2::before{background:#4dabff;}
.q3::before{background:#ffd666;}
.q4::before{background:#6ee7b7;}

h2{font-size:14px;font-weight:600;margin-bottom:10px;}
.tasks{display:flex;flex-direction:column;gap:8px;}

.task{
  padding:10px 12px;
  border-radius:12px;
  font-size:13px;
  cursor:pointer;
  transition:.25s;
}
.task.q1{background:#ff6b6b;}
.task.q2{background:#4dabff;}
.task.q3{background:#ffd666;color:#222;}
.task.q4{background:#6ee7b7;color:#222;}
.task small{display:block;font-size:11px;opacity:.75;margin-top:4px;}

/* ✅ ВЫПОЛНЕННАЯ ЗАДАЧА */
.task.done{
  opacity:.35;
  text-decoration:line-through;
  filter:grayscale(1);
}

.pomodoro{
  margin:14px;
  padding:18px;
  background:linear-gradient(180deg,#1e2334,#191d2b);
  border-radius:22px;
}
.timer{text-align:center;font-size:44px;font-weight:700;margin:16px 0;}
.pomo-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
label{font-size:12px;color:var(--muted);}
input{
  width:100%;padding:10px 12px;border-radius:12px;
  border:none;background:#0f1324;color:white;
}
.mode-buttons,.buttons{
  display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;
}
.buttons{grid-template-columns:1fr 1fr 1fr;}
button{
  padding:12px;border-radius:14px;border:none;
  font-weight:600;cursor:pointer;color:white;
}
.primary{background:linear-gradient(135deg,#6f7dff,#7f8cff);}
.secondary{background:linear-gradient(135deg,#4a4f6a,#5c6280);}
button.active{outline:2px solid var(--accent);}
</style>
</head>

<body>

<header>Матрица Эйзенхауэра</header>

<div class="board">
  <div class="quadrant q1" data-id="q1"><h2>Важно · Срочно</h2><div class="tasks"></div></div>
  <div class="quadrant q2" data-id="q2"><h2>Важно · Не срочно</h2><div class="tasks"></div></div>
  <div class="quadrant q3" data-id="q3"><h2>Не важно · Срочно</h2><div class="tasks"></div></div>
  <div class="quadrant q4" data-id="q4"><h2>Не важно · Не срочно</h2><div class="tasks"></div></div>
</div>

<div class="pomodoro">
  <div class="pomo-grid">
    <div><label>Работа (мин)</label><input id="workInput" type="number" value="25"></div>
    <div><label>Отдых (мин)</label><input id="breakInput" type="number" value="5"></div>
  </div>

  <div id="timer" class="timer">25:00</div>

  <div class="mode-buttons">
    <button id="workBtn" class="secondary active">Работа</button>
    <button id="breakBtn" class="secondary">Отдых</button>
  </div>

  <div class="buttons">
    <button id="startBtn" class="primary">Старт</button>
    <button id="pauseBtn" class="secondary">Пауза</button>
    <button id="resetBtn" class="secondary">Сбросить</button>
  </div>
</div>

<script>
/* ===== NOTIFICATIONS ===== */
if ("Notification" in window && Notification.permission === "default") {
  Notification.requestPermission();
}

/* ===== SOUND ===== */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSound(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 880;
  g.gain.value = 0.12;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + 0.3);
}

function playFinishSound(times = 3, interval = 450){
  let count = 0;
  const id = setInterval(() => {
    playSound();
    count++;
    if(count >= times) clearInterval(id);
  }, interval);
}

/* ===== TIMER ===== */
let mode='work';
let duration=workInput.value*60000;
let endTime=null;
let raf=null;
let finished=false;

function format(ms){
  ms=Math.max(0,ms);
  const s=Math.floor(ms/1000);
  return String(Math.floor(s/60)).padStart(2,'0')+':'+String(s%60).padStart(2,'0');
}

function notify(){
  playFinishSound(3);
  if(Notification.permission==="granted"){
    new Notification("⏰ Таймер завершён",{
      body: mode==='work' ? "Пора отдыхать" : "Пора работать"
    });
  }
}

function tick(){
  const left=endTime-Date.now();
  timer.textContent=format(left);
  if(left<=0 && !finished){
    finished=true;
    notify();
    cancelAnimationFrame(raf);
    raf=null;
  } else if(left>0){
    raf=requestAnimationFrame(tick);
  }
}

function start(){
  if(raf)return;
  audioCtx.resume();
  finished=false;
  endTime=Date.now()+duration;
  tick();
}

function pause(){
  if(!raf)return;
  duration=endTime-Date.now();
  cancelAnimationFrame(raf);
  raf=null;
}

function reset(){
  pause();
  finished=false;
  duration=(mode==='work'?workInput.value:breakInput.value)*60000;
  timer.textContent=format(duration);
}

function setMode(m){
  mode=m;
  reset();
  workBtn.classList.toggle('active',m==='work');
  breakBtn.classList.toggle('active',m==='break');
}

startBtn.onclick=start;
pauseBtn.onclick=pause;
resetBtn.onclick=reset;
workBtn.onclick=()=>setMode('work');
breakBtn.onclick=()=>setMode('break');

reset();

/* ✅ ОТМЕТКА ВЫПОЛНЕНИЯ ЗАДАЧ */
document.addEventListener('click',e=>{
  const task=e.target.closest('.task');
  if(task) task.classList.toggle('done');
});
</script>

</body>
</html>
